{
  "timestamp": "2025-09-09T13:54:02.329Z",
  "totalTests": 44,
  "passedTests": 27,
  "failedTests": 17,
  "pendingTests": 0,
  "testSuites": 6,
  "passedTestSuites": 0,
  "failedTestSuites": 6,
  "coverage": {
    "statements": 3.47,
    "branches": 0.76,
    "functions": 1.9,
    "lines": 3.54
  },
  "testResults": [
    {
      "testFilePath": "tests\\unit\\middleware\\security.test.js",
      "numPassingTests": 0,
      "numFailingTests": 0,
      "numPendingTests": 0,
      "duration": 0,
      "failureMessage": "  ● Test suite failed to run\n\n    JWT_SECRET is required but not set\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     \u001b[36mfor\u001b[39m (\u001b[36mconst\u001b[39m secret \u001b[36mof\u001b[39m requiredSecrets) {\n     \u001b[90m 26 |\u001b[39m       \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39msecret\u001b[33m.\u001b[39mvalue) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m         \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`${secret.name} is required but not set`\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m       }\n     \u001b[90m 29 |\u001b[39m       \u001b[36mif\u001b[39m (secret\u001b[33m.\u001b[39mvalue\u001b[33m.\u001b[39mlength \u001b[33m<\u001b[39m secret\u001b[33m.\u001b[39mminLength) {\n     \u001b[90m 30 |\u001b[39m         \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`${secret.name} must be at least ${secret.minLength} characters long`\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at SecurityManager.validateSecrets (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:27:15)\n      at new validateSecrets (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:15:10)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:367:25)\n      at Object.require (E:\\web\\New folder (2)../../../link-shortener/src/middleware/security.js:8:25)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/middleware/security.test.js:2:28)\n"
    },
    {
      "testFilePath": "tests\\url.test.js",
      "numPassingTests": 0,
      "numFailingTests": 0,
      "numPendingTests": 0,
      "duration": 0,
      "failureMessage": "  ● Test suite failed to run\n\n    Cannot find module '../src/routes/urlRoutes' from 'tests/url.test.js'\n\n    \u001b[0m \u001b[90m 3 |\u001b[39m \u001b[36mconst\u001b[39m { \u001b[33mMongoMemoryServer\u001b[39m } \u001b[33m=\u001b[39m require(\u001b[32m'mongodb-memory-server'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 4 |\u001b[39m \u001b[36mconst\u001b[39m express \u001b[33m=\u001b[39m require(\u001b[32m'express'\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 5 |\u001b[39m \u001b[36mconst\u001b[39m urlRoutes \u001b[33m=\u001b[39m require(\u001b[32m'../src/routes/urlRoutes'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m   |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 6 |\u001b[39m \u001b[36mconst\u001b[39m \u001b[33mUrl\u001b[39m \u001b[33m=\u001b[39m require(\u001b[32m'../src/models/Url'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 7 |\u001b[39m\n     \u001b[90m 8 |\u001b[39m jest\u001b[33m.\u001b[39msetTimeout(\u001b[35m30000\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Resolver._throwModNotFoundError (E:\\web\\New folder (2)../../../link-shortener/node_modules/jest-resolve/build/resolver.js:427:11)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/url.test.js:5:19)\n"
    },
    {
      "testFilePath": "tests\\integration\\api\\urls.test.js",
      "numPassingTests": 0,
      "numFailingTests": 0,
      "numPendingTests": 0,
      "duration": 0,
      "failureMessage": "  ● Test suite failed to run\n\n    JWT_REFRESH_SECRET is required but not set\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     \u001b[36mfor\u001b[39m (\u001b[36mconst\u001b[39m secret \u001b[36mof\u001b[39m requiredSecrets) {\n     \u001b[90m 26 |\u001b[39m       \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39msecret\u001b[33m.\u001b[39mvalue) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m         \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`${secret.name} is required but not set`\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m       }\n     \u001b[90m 29 |\u001b[39m       \u001b[36mif\u001b[39m (secret\u001b[33m.\u001b[39mvalue\u001b[33m.\u001b[39mlength \u001b[33m<\u001b[39m secret\u001b[33m.\u001b[39mminLength) {\n     \u001b[90m 30 |\u001b[39m         \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`${secret.name} must be at least ${secret.minLength} characters long`\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at SecurityManager.validateSecrets (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:27:15)\n      at new validateSecrets (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:15:10)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:367:25)\n      at Object.require (E:\\web\\New folder (2)../../../link-shortener/src/app.js:13:25)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/integration/api/urls.test.js:3:13)\n"
    },
    {
      "testFilePath": "tests\\integration\\api\\auth.test.js",
      "numPassingTests": 0,
      "numFailingTests": 0,
      "numPendingTests": 0,
      "duration": 0,
      "failureMessage": "  ● Test suite failed to run\n\n    JWT_REFRESH_SECRET is required but not set\n\n    \u001b[0m \u001b[90m 25 |\u001b[39m     \u001b[36mfor\u001b[39m (\u001b[36mconst\u001b[39m secret \u001b[36mof\u001b[39m requiredSecrets) {\n     \u001b[90m 26 |\u001b[39m       \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39msecret\u001b[33m.\u001b[39mvalue) {\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 27 |\u001b[39m         \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`${secret.name} is required but not set`\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m               \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 28 |\u001b[39m       }\n     \u001b[90m 29 |\u001b[39m       \u001b[36mif\u001b[39m (secret\u001b[33m.\u001b[39mvalue\u001b[33m.\u001b[39mlength \u001b[33m<\u001b[39m secret\u001b[33m.\u001b[39mminLength) {\n     \u001b[90m 30 |\u001b[39m         \u001b[36mthrow\u001b[39m \u001b[36mnew\u001b[39m \u001b[33mError\u001b[39m(\u001b[32m`${secret.name} must be at least ${secret.minLength} characters long`\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at SecurityManager.validateSecrets (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:27:15)\n      at new validateSecrets (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:15:10)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/src/config/security.js:367:25)\n      at Object.require (E:\\web\\New folder (2)../../../link-shortener/src/app.js:13:25)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/integration/api/auth.test.js:3:13)\n"
    },
    {
      "testFilePath": "tests\\unit\\services\\urlService.test.js",
      "numPassingTests": 5,
      "numFailingTests": 12,
      "numPendingTests": 0,
      "duration": 13647,
      "failureMessage": "  ● UrlService › createShortUrl › should create a new short URL successfully\n\n    TypeError: Url.findOne.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 32 |\u001b[39m       }\u001b[33m;\u001b[39m\n     \u001b[90m 33 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 34 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mnull\u001b[39m)\u001b[33m;\u001b[39m \u001b[90m// No existing URL\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 35 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mmockImplementation(() \u001b[33m=>\u001b[39m mockUrl)\u001b[33m;\u001b[39m\n     \u001b[90m 36 |\u001b[39m       cacheService\u001b[33m.\u001b[39mcacheUrl\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 37 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:34:19)\n\n  ● UrlService › createShortUrl › should return existing URL if duplicate found\n\n    TypeError: Url.findOne.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 60 |\u001b[39m       }\u001b[33m;\u001b[39m\n     \u001b[90m 61 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 62 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue(existingUrl)\u001b[33m;\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 63 |\u001b[39m       cacheService\u001b[33m.\u001b[39mcacheUrl\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 64 |\u001b[39m\n     \u001b[90m 65 |\u001b[39m       \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m urlService\u001b[33m.\u001b[39mcreateShortUrl(urlData\u001b[33m,\u001b[39m userId)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:62:19)\n\n  ● UrlService › createShortUrl › should throw error for invalid custom alias\n\n    TypeError: Url.findOne.mockResolvedValueOnce is not a function\n\n    \u001b[0m \u001b[90m 77 |\u001b[39m\n     \u001b[90m 78 |\u001b[39m       \u001b[90m// Mock alias already exists\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 79 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValueOnce(\u001b[36mnull\u001b[39m)\u001b[33m;\u001b[39m \u001b[90m// No existing URL\u001b[39m\n     \u001b[90m    |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 80 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValueOnce({ shortCode\u001b[33m:\u001b[39m \u001b[32m'taken'\u001b[39m })\u001b[33m;\u001b[39m \u001b[90m// Alias exists\u001b[39m\n     \u001b[90m 81 |\u001b[39m\n     \u001b[90m 82 |\u001b[39m       \u001b[36mawait\u001b[39m expect(urlService\u001b[33m.\u001b[39mcreateShortUrl(urlData\u001b[33m,\u001b[39m userId))\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:79:19)\n\n  ● UrlService › getUrlByShortCode › should return cached URL if available\n\n    TypeError: cacheService.getCachedUrl.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m  95 |\u001b[39m       }\u001b[33m;\u001b[39m\n     \u001b[90m  96 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m  97 |\u001b[39m       cacheService\u001b[33m.\u001b[39mgetCachedUrl\u001b[33m.\u001b[39mmockResolvedValue(cachedUrl)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m  98 |\u001b[39m\n     \u001b[90m  99 |\u001b[39m       \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m urlService\u001b[33m.\u001b[39mgetUrlByShortCode(shortCode)\u001b[33m;\u001b[39m\n     \u001b[90m 100 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:97:33)\n\n  ● UrlService › getUrlByShortCode › should fetch from database if not cached\n\n    TypeError: cacheService.getCachedUrl.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 114 |\u001b[39m       }\u001b[33m;\u001b[39m\n     \u001b[90m 115 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 116 |\u001b[39m       cacheService\u001b[33m.\u001b[39mgetCachedUrl\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mnull\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 117 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockReturnValue({\n     \u001b[90m 118 |\u001b[39m         populate\u001b[33m:\u001b[39m jest\u001b[33m.\u001b[39mfn()\u001b[33m.\u001b[39mmockResolvedValue(dbUrl)\n     \u001b[90m 119 |\u001b[39m       })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:116:33)\n\n  ● UrlService › getUrlByShortCode › should throw NotFoundError if URL not found\n\n    TypeError: cacheService.getCachedUrl.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 133 |\u001b[39m       \u001b[36mconst\u001b[39m shortCode \u001b[33m=\u001b[39m \u001b[32m'notfound'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 134 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 135 |\u001b[39m       cacheService\u001b[33m.\u001b[39mgetCachedUrl\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mnull\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                 \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 136 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockReturnValue({\n     \u001b[90m 137 |\u001b[39m         populate\u001b[33m:\u001b[39m jest\u001b[33m.\u001b[39mfn()\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mnull\u001b[39m)\n     \u001b[90m 138 |\u001b[39m       })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:135:33)\n\n  ● UrlService › updateUrl › should update URL successfully\n\n    TypeError: Url.findOne.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 161 |\u001b[39m       }\u001b[33m;\u001b[39m\n     \u001b[90m 162 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 163 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue(mockUrl)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 164 |\u001b[39m       cacheService\u001b[33m.\u001b[39mcacheUrl\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 165 |\u001b[39m       cacheService\u001b[33m.\u001b[39minvalidateAnalytics\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 166 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:163:19)\n\n  ● UrlService › updateUrl › should throw NotFoundError if URL not found\n\n    TypeError: Url.findOne.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 179 |\u001b[39m       \u001b[36mconst\u001b[39m updateData \u001b[33m=\u001b[39m { title\u001b[33m:\u001b[39m \u001b[32m'New Title'\u001b[39m }\u001b[33m;\u001b[39m\n     \u001b[90m 180 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 181 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mnull\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 182 |\u001b[39m\n     \u001b[90m 183 |\u001b[39m       \u001b[36mawait\u001b[39m expect(urlService\u001b[33m.\u001b[39mupdateUrl(shortCode\u001b[33m,\u001b[39m updateData\u001b[33m,\u001b[39m userId))\n     \u001b[90m 184 |\u001b[39m         \u001b[33m.\u001b[39mrejects\u001b[33m.\u001b[39mtoThrow(\u001b[32m'URL not found'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:181:19)\n\n  ● UrlService › deleteUrl › should soft delete URL successfully\n\n    TypeError: Url.findOne.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 200 |\u001b[39m       }\u001b[33m;\u001b[39m\n     \u001b[90m 201 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 202 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue(mockUrl)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 203 |\u001b[39m       cacheService\u001b[33m.\u001b[39minvalidateUrl\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 204 |\u001b[39m       cacheService\u001b[33m.\u001b[39minvalidateAnalytics\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 205 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:202:19)\n\n  ● UrlService › trackClick › should track click and update URL stats\n\n    TypeError: cacheService.cacheUrl.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 233 |\u001b[39m       jest\u001b[33m.\u001b[39mspyOn(urlService\u001b[33m,\u001b[39m \u001b[32m'getUrlByShortCode'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue(mockUrl)\u001b[33m;\u001b[39m\n     \u001b[90m 234 |\u001b[39m       jest\u001b[33m.\u001b[39mspyOn(urlService\u001b[33m,\u001b[39m \u001b[32m'trackAnalytics'\u001b[39m)\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 235 |\u001b[39m       cacheService\u001b[33m.\u001b[39mcacheUrl\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mtrue\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                             \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 236 |\u001b[39m\n     \u001b[90m 237 |\u001b[39m       \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m urlService\u001b[33m.\u001b[39mtrackClick(shortCode\u001b[33m,\u001b[39m clickData)\u001b[33m;\u001b[39m\n     \u001b[90m 238 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:235:29)\n\n  ● UrlService › checkAliasAvailability › should return true if alias is available\n\n    TypeError: Url.findOne.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 280 |\u001b[39m       \u001b[36mconst\u001b[39m alias \u001b[33m=\u001b[39m \u001b[32m'available'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 281 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 282 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue(\u001b[36mnull\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 283 |\u001b[39m\n     \u001b[90m 284 |\u001b[39m       \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m urlService\u001b[33m.\u001b[39mcheckAliasAvailability(alias)\u001b[33m;\u001b[39m\n     \u001b[90m 285 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:282:19)\n\n  ● UrlService › checkAliasAvailability › should return false if alias is taken\n\n    TypeError: Url.findOne.mockResolvedValue is not a function\n\n    \u001b[0m \u001b[90m 297 |\u001b[39m       \u001b[36mconst\u001b[39m alias \u001b[33m=\u001b[39m \u001b[32m'taken'\u001b[39m\u001b[33m;\u001b[39m\n     \u001b[90m 298 |\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 299 |\u001b[39m       \u001b[33mUrl\u001b[39m\u001b[33m.\u001b[39mfindOne\u001b[33m.\u001b[39mmockResolvedValue({ shortCode\u001b[33m:\u001b[39m alias })\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                   \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 300 |\u001b[39m\n     \u001b[90m 301 |\u001b[39m       \u001b[36mconst\u001b[39m result \u001b[33m=\u001b[39m \u001b[36mawait\u001b[39m urlService\u001b[33m.\u001b[39mcheckAliasAvailability(alias)\u001b[33m;\u001b[39m\n     \u001b[90m 302 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/services/urlService.test.js:299:19)\n"
    },
    {
      "testFilePath": "tests\\unit\\models\\User.test.js",
      "numPassingTests": 22,
      "numFailingTests": 5,
      "numPendingTests": 0,
      "duration": 33704,
      "failureMessage": "  ● User Model › Instance Methods › comparePassword › should handle null password\n\n    Illegal arguments: object, string\n\n    \u001b[0m \u001b[90m 100 |\u001b[39m \u001b[33mUserSchema\u001b[39m\u001b[33m.\u001b[39mmethods\u001b[33m.\u001b[39mcomparePassword \u001b[33m=\u001b[39m \u001b[36masync\u001b[39m \u001b[36mfunction\u001b[39m(candidatePassword) {\n     \u001b[90m 101 |\u001b[39m   \u001b[36mif\u001b[39m (\u001b[33m!\u001b[39m\u001b[36mthis\u001b[39m\u001b[33m.\u001b[39mpassword) \u001b[36mreturn\u001b[39m \u001b[36mfalse\u001b[39m\u001b[33m;\u001b[39m \u001b[90m// Google users don't have passwords\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 102 |\u001b[39m   \u001b[36mreturn\u001b[39m \u001b[36mawait\u001b[39m bcrypt\u001b[33m.\u001b[39mcompare(candidatePassword\u001b[33m,\u001b[39m \u001b[36mthis\u001b[39m\u001b[33m.\u001b[39mpassword)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                       \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 103 |\u001b[39m }\u001b[33m;\u001b[39m\n     \u001b[90m 104 |\u001b[39m\n     \u001b[90m 105 |\u001b[39m \u001b[90m// Method to get user data without sensitive fields\u001b[39m\u001b[0m\n\n      at _async (E:\\web\\New folder (2)../../../link-shortener/node_modules/bcryptjs/dist/bcrypt.js:286:46)\n      at E:\\web\\New folder (2)../../../link-shortener/node_modules/bcryptjs/dist/bcrypt.js:307:17\n      at Object.bcrypt.compare (E:\\web\\New folder (2)../../../link-shortener/node_modules/bcryptjs/dist/bcrypt.js:306:20)\n      at model.compare [as comparePassword] (E:\\web\\New folder (2)../../../link-shortener/src/models/User.js:102:23)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/models/User.test.js:172:36)\n\n  ● User Model › Instance Methods › toJSON › should exclude password from JSON output\n\n    expect(received).toHaveProperty(path)\n\n    Expected path: \"id\"\n    Received path: []\n\n    Received value: {\"__v\": 0, \"_id\": \"68c0316ded1758a77cfc5da5\", \"createdAt\": 2025-09-09T13:53:49.720Z, \"email\": \"test@example.com\", \"isActive\": true, \"role\": \"user\", \"updatedAt\": 2025-09-09T13:53:49.720Z, \"username\": \"testuser\"}\n\n    \u001b[0m \u001b[90m 179 |\u001b[39m         \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m user\u001b[33m.\u001b[39mtoJSON()\u001b[33m;\u001b[39m\n     \u001b[90m 180 |\u001b[39m         \n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 181 |\u001b[39m         expect(json)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'id'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                      \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 182 |\u001b[39m         expect(json)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'username'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 183 |\u001b[39m         expect(json)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'email'\u001b[39m)\u001b[33m;\u001b[39m\n     \u001b[90m 184 |\u001b[39m         expect(json)\u001b[33m.\u001b[39mtoHaveProperty(\u001b[32m'role'\u001b[39m)\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/models/User.test.js:181:22)\n\n  ● User Model › Instance Methods › toJSON › should include virtual id field\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"68c0316eed1758a77cfc5da8\"\n    Received: undefined\n\n    \u001b[0m \u001b[90m 190 |\u001b[39m         \u001b[36mconst\u001b[39m json \u001b[33m=\u001b[39m user\u001b[33m.\u001b[39mtoJSON()\u001b[33m;\u001b[39m\n     \u001b[90m 191 |\u001b[39m         \n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 192 |\u001b[39m         expect(json\u001b[33m.\u001b[39mid)\u001b[33m.\u001b[39mtoBe(user\u001b[33m.\u001b[39m_id\u001b[33m.\u001b[39mtoString())\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                         \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 193 |\u001b[39m       })\u001b[33m;\u001b[39m\n     \u001b[90m 194 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 195 |\u001b[39m   })\u001b[33m;\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/models/User.test.js:192:25)\n\n  ● User Model › Google OAuth Fields › should save user with Google OAuth data\n\n    expect(received).toBe(expected) // Object.is equality\n\n    Expected: \"google\"\n    Received: undefined\n\n    \u001b[0m \u001b[90m 210 |\u001b[39m       expect(savedUser\u001b[33m.\u001b[39mgoogleId)\u001b[33m.\u001b[39mtoBe(userData\u001b[33m.\u001b[39mgoogleId)\u001b[33m;\u001b[39m\n     \u001b[90m 211 |\u001b[39m       expect(savedUser\u001b[33m.\u001b[39mavatar)\u001b[33m.\u001b[39mtoBe(userData\u001b[33m.\u001b[39mavatar)\u001b[33m;\u001b[39m\n    \u001b[31m\u001b[1m>\u001b[22m\u001b[39m\u001b[90m 212 |\u001b[39m       expect(savedUser\u001b[33m.\u001b[39mprovider)\u001b[33m.\u001b[39mtoBe(userData\u001b[33m.\u001b[39mprovider)\u001b[33m;\u001b[39m\n     \u001b[90m     |\u001b[39m                                  \u001b[31m\u001b[1m^\u001b[22m\u001b[39m\n     \u001b[90m 213 |\u001b[39m       expect(savedUser\u001b[33m.\u001b[39mpassword)\u001b[33m.\u001b[39mtoBeUndefined()\u001b[33m;\u001b[39m \u001b[90m// No password for OAuth users\u001b[39m\n     \u001b[90m 214 |\u001b[39m     })\u001b[33m;\u001b[39m\n     \u001b[90m 215 |\u001b[39m\u001b[0m\n\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/models/User.test.js:212:34)\n\n  ● User Model › User Roles › should reject invalid role\n\n    expect(received).rejects.toThrow(expected)\n\n    Expected pattern: /role.*enum/i\n    Received message: \"User validation failed: role: Role must be either user or admin\"\n\n      at model.Object.<anonymous>.Document.invalidate (E:\\web\\New folder (2)../../../link-shortener/node_modules/mongoose/lib/document.js:3358:32)\n      at E:\\web\\New folder (2)../../../link-shortener/node_modules/mongoose/lib/document.js:3119:17\n      at E:\\web\\New folder (2)../../../link-shortener/node_modules/mongoose/lib/schemaType.js:1416:9\n      at Object.toThrow (E:\\web\\New folder (2)../../../link-shortener/node_modules/expect/build/index.js:218:22)\n      at Object.<anonymous> (E:\\web\\New folder (2)../../../link-shortener/tests/unit/models/User.test.js:266:41)\n"
    }
  ]
}